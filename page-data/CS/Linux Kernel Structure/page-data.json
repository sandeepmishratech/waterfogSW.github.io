{"componentChunkName":"component---src-templates-blog-post-js","path":"/CS/Linux Kernel Structure/","result":{"data":{"site":{"siteMetadata":{"title":"For The Record","author":"San Kim","siteUrl":"https://waterfogsw.github.io","comment":{"disqusShortName":"","utterances":"waterfogSW/waterfogSW.github.io"}}},"markdownRemark":{"id":"5122517e-b693-5957-88db-da433f4f8db9","excerpt":"운영체제가 관리해야 할 자원은 크게 물리적인 자원과 추상적인 자원으로 구분할 수 있습니다. 운영체제에서 커널의 역할은 CPU나 메모리와 같은 물리적인 자원을 사용자에게 태스크와 세그먼트, 페이지와 같은 추상적인 자원으로 추상화 하여 사용자에게 인터페이스를 제공하는것입니다. 덕분에 우리는 메모리 레이아웃, 스케줄러, 네트워킹 등과 같은 시스템의 세부 구현 사항에 대한 이해 없이도 프로그램을 실행시킬 수 있습니다. 리눅스 커널의 구성요소 kerenl kernel 디렉토리에는 Figure 1의 Task…","html":"<p>운영체제가 관리해야 할 자원은 크게 물리적인 자원과 추상적인 자원으로 구분할 수 있습니다.</p>\n<p>운영체제에서 커널의 역할은 CPU나 메모리와 같은 물리적인 자원을 사용자에게 태스크와 세그먼트, 페이지와 같은 추상적인 자원으로 추상화 하여 사용자에게 인터페이스를 제공하는것입니다. 덕분에 우리는 메모리 레이아웃, 스케줄러, 네트워킹 등과 같은 시스템의 세부 구현 사항에 대한 이해 없이도 프로그램을 실행시킬 수 있습니다.</p>\n<h2 id=\"리눅스-커널의-구성요소\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%BB%A4%EB%84%90%EC%9D%98-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C\" aria-label=\"리눅스 커널의 구성요소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리눅스 커널의 구성요소</h2>\n<div align=\"center\">\n\t<img src=\"https://user-images.githubusercontent.com/28651727/142136168-764b3260-763b-42d5-8629-0af53dfd8a6c.png\">\n\t<b>Figure 1 : Linux Kernel</b>\n</div>\n&#xADF8;&#xB9BC;&#xC740; &#xB9AC;&#xB205;&#xC2A4; &#xCEE4;&#xB110; &#xB0B4;&#xBD80;&#xB97C; &#xB17C;&#xB9AC;&#xC801;&#xC778; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB85C; &#xAD6C;&#xBD84;&#xD558;&#xC5EC; &#xADF8;&#xB9B0; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. \n&#xCEE4;&#xB110;&#xC758; Manager&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC694;&#xC18C;&#xB4E4;&#xC740; &#xAC01;&#xAC01; Filesystem Manger&#xB294; &#xB514;&#xC2A4;&#xD06C;&#xB97C; &#xD30C;&#xC77C;&#xB85C;, Memroy Manager&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; Page&#xB610;&#xB294; Segment&#xB85C;, Task Manger&#xB294; CPU&#xB97C; Task&#xB85C;, Network Manager&#xB294; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC7A5;&#xCE58;&#xB97C; &#xC18C;&#xCF13;&#xC73C;&#xB85C;, Device Manager&#xB294; block &#xB610;&#xB294; character&#xB85C; &#xBB3C;&#xB9AC;&#xC801;&#xC778; &#xC790;&#xC6D0;&#xC744; &#xCD94;&#xC0C1;&#xC801;&#xC778; &#xC790;&#xC6D0;&#xC73C;&#xB85C;&#xC368; &#xC81C;&#xACF5;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;.\n<div align=\"center\">\n\t<img src=\"https://linux-kernel-labs.github.io/refs/heads/master/_images/ditaa-f45246aade5ecc7cfb71f7f103a57f95fc7c2b9e.png\" style=\"width : 600px\">\n\t<img src=\"https://user-images.githubusercontent.com/28651727/142143439-9c028907-cc8b-457e-ae7d-7150913a2d8d.png\" style=\"width : 600px\">\n</div>\n<div align=center>\n<b>Figure 2 : Linux Kernel Source Organization</b>\n</div>\n<h3 id=\"kerenl\" style=\"position:relative;\"><a href=\"#kerenl\" aria-label=\"kerenl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kerenl</h3>\n<p>kernel 디렉토리에는 Figure 1의 Task Manager에 해당하는 부분이 구현된 디렉터리입니다. Task 생성 및 소멸, 스케줄링, 시그널 처리 등의 기능을 구현하고 있습니다.</p>\n<h3 id=\"arch\" style=\"position:relative;\"><a href=\"#arch\" aria-label=\"arch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arch</h3>\n<p>arch 디렉토리에는 하드웨어에 종속적인 부분들을 구현한 디렉토리로 cpu의 타입에 따라 하위 디렉토리가 구성다. 대표적인 architecture인 x86, arm등을 여기서 확인할 수 있습니다.</p>\n<p>x86을 기준으로 살펴보면 <code class=\"language-text\">./arch/x86/boot</code>에는 부팅시 사용하는 부트 스트랩 코드, <code class=\"language-text\">./arch/x86/kernel</code>에는 task manager의 문맥교환 및 스레드 관리, <code class=\"language-text\">./arch/x86/mm</code> page fault관련 처리 기능 등 하드웨어 종속적인 부분들이 구현되어있음을 확인할 수 있습니다.</p>\n<h3 id=\"fs\" style=\"position:relative;\"><a href=\"#fs\" aria-label=\"fs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs</h3>\n<p>fs 디렉토리에는 Figure 1의 Filesystem Manager에 해당하는 부분이 구현된 디렉터리 입니다. 리눅스에서 지원하는 ext2, ext3, ext4, f2fs등의 파일시스템이 구현되어 있으며 <code class=\"language-text\">open()</code>, <code class=\"language-text\">read()</code>, <code class=\"language-text\">write()</code>와 같은 파일관련 시스템 호출이 구현되어 있습니다</p>\n<h3 id=\"mm\" style=\"position:relative;\"><a href=\"#mm\" aria-label=\"mm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mm</h3>\n<p>Memory Manager가 구현된 디렉토리로물리메모리, 가상메모리 관리, Task마다 할당되는 메모리 객체관리 등의 기능이 구현되어 있습니다.</p>\n<h3 id=\"driver\" style=\"position:relative;\"><a href=\"#driver\" aria-label=\"driver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>driver</h3>\n<p>주변 장치를 추상화 하는 디바이스 드라이버가 구현된 디렉토리로 android, bluetooth, dma등 다양한 주변장치에 대한 드라이버가 구현되어있는것을 확인할 수 있습니다.</p>\n<h3 id=\"net\" style=\"position:relative;\"><a href=\"#net\" aria-label=\"net permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>net</h3>\n<p>Network Manager가 구현된 디렉토리로 802, ipv4,6, appletalk, bluetooth등 다양한 통신 프로토콜이 구현되어있는것을 확인할 수 있습니다.</p>\n<p>이외에도 프로세스간 통신기능을 구현한 ipc디렉토리, 커널 초기화를 구현한 init디렉토리, 리눅스 커널의 헤더파일을 구현한 inlcude디렉토리, 이외 다양한 기능들을 구현한 others디렉토리가 있습니다. </p>\n<h2 id=\"process-managercpu\" style=\"position:relative;\"><a href=\"#process-managercpu\" aria-label=\"process managercpu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Process manager(CPU)</h2>\n<p>커널은 System Call Interface(이하 SCI)를 통해 응용 프로그램에 인터페이스를 제공하여 프로세스 생성(fork(), exec(), …), 프로세스 종료(kill(), exit()), 프로세스간의 통신 및 동기화(signal(),…)를 수행합니다.</p>\n<p>실행중인 스레드들은 CPU를 공유해야 합니다. 리눅스의 경우에는 CFS(Completely Fair Scheduler) 스케줄러를 통해 이를 관리를 합니다. 시스템이 현재 프로세스를 계속 수행할 수 없는 상황이 되면 커널의 <code class=\"language-text\">schedule()</code>함수가 호출되고 그 내부의 <code class=\"language-text\">__schedule()</code>함수가 스케줄링의 핵심동작을 수행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> __sched notrace <span class=\"token function\">__schedule</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> preempt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span>prev<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>next<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 프로세스의 속성 정보를 표현하는 자료구조</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> <span class=\"token operator\">*</span>switch_count<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">rq_flags</span> rf<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">rq</span> <span class=\"token operator\">*</span>rq<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> cpu<span class=\"token punctuation\">;</span>\n\n\tcpu <span class=\"token operator\">=</span> <span class=\"token function\">smp_processor_id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trq <span class=\"token operator\">=</span> <span class=\"token function\">cpu_rq</span><span class=\"token punctuation\">(</span>cpu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tprev <span class=\"token operator\">=</span> rq<span class=\"token operator\">-></span>curr<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 현재 실행중인 프로세스의 태스크 디스크립터 주소를  prev로</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\tnext <span class=\"token operator\">=</span> <span class=\"token function\">pick_next_task</span><span class=\"token punctuation\">(</span>rq<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 다음 실행할 프로세스의 태스크 디스크립터 주소를 next로</span>\n\t<span class=\"token function\">clear_tsk_need_resched</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">clear_preempt_need_resched</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">likely</span><span class=\"token punctuation\">(</span>prev <span class=\"token operator\">!=</span> next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// prev와 next가 다른경우</span>\n\t\trq<span class=\"token operator\">-></span>nr_switches<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\trq<span class=\"token operator\">-></span>curr <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 런큐 curr 필드에 저장합니다.</span>\n\n\t\t<span class=\"token operator\">++</span><span class=\"token operator\">*</span>switch_count<span class=\"token punctuation\">;</span> <span class=\"token comment\">// context switch 횟수 정보를 담고있습니다.</span>\n\n\t\t<span class=\"token function\">trace_sched_switch</span><span class=\"token punctuation\">(</span>preempt<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">/* Also unlocks the rq: */</span>\n\t\trq <span class=\"token operator\">=</span> <span class=\"token function\">context_switch</span><span class=\"token punctuation\">(</span>rq<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// context switch를 수행합니다.</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\trq<span class=\"token operator\">-></span>clock_update_flags <span class=\"token operator\">&amp;=</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">(</span>RQCF_ACT_SKIP<span class=\"token operator\">|</span>RQCF_REQ_SKIP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">rq_unlock_irq</span><span class=\"token punctuation\">(</span>rq<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">balance_callback</span><span class=\"token punctuation\">(</span>rq<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"[OS] Linux Kernel Structure","date":"November 17, 2021"}}},"pageContext":{"slug":"/CS/Linux Kernel Structure/","previous":{"fields":{"slug":"/BackEnd/Spring-React/"},"frontmatter":{"title":"[Spring] SpringBoot-React 연동"}},"next":{"fields":{"slug":"/CS/Singletone/"},"frontmatter":{"title":"[Design Pattern]Singleton Pattern"}}}}}